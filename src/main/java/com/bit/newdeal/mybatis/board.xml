<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.bit.newdeal.dao.boardDao">
	<select id="containerOne" resultType="Board">

	</select>

	<select id="containerTwo" resultType="Board">

	</select>

	<select id="selectOneBoard" parameterType="int"
		resultType="board">

	 select temp.bno "bno", temp.mid "mid", temp.title "title",
temp.bContent "bContent", temp.writeDate "writeDate",
temp.readCount "readCount", temp.thumbNail "thumbNail",
temp.categoryCode "categoryCode", temp.bDelete "bDelete",
temp.categoryName "categoryName",
m.nickname "nickname"
from member m join
(SELECT b.bno "bno", b.mid "mid", b.title "title",
b.bContent "bContent", DATE_FORMAT(b.writeDate,'%Y-%m-%d') "writeDate",
b.readCount "readCount", b.thumbNail "thumbNail",
b.categoryCode "categoryCode", b.bDelete "bDelete",
c.categoryName "categoryName"
FROM board b join categoryCode c using(categoryCode)) temp
on m.id = temp.mid
WHERE temp.bDelete='0'
and temp.bno = #{bno}

      
	</select>

	<select id="selectAllBoard" resultType="Board">
	

	   SELECT bno, mid, title, bContent, DATE_FORMAT(writeDate,'%Y-%m-%d') WriteDate, readCount, thumbNail, categoryCode, bDelete, likeCount
          FROM board
           WHERE bDelete='0' order by bno desc  

	</select>

  	<insert id="insertBoard" parameterType="Board">
  	   insert into board(mid, title, bContent, thumbNail, categoryCode)
  	   values(#{mid}, #{title}, #{bContent}, #{thumbNail}, #{categoryCode})
  	</insert>
  	
	<update id="updateBoard" parameterType="Board">

	</update>

	<select id="searchBoard" parameterType="String"
		resultType="Board">

	</select>
	
	<update id="readCount" parameterType="int">

        update board

        set readCount = readCount + 1

        where bno = #{bno}

 		</update>
 		
 		<select id="likeCount" parameterType="int" resultType="int">

        select count(bno) from likelist where bno=#{bno} 
    

 		</select>
 		
 

	  	
  	<select id="selectMyBoard" parameterType="String" resultType="Board">
  		select title, bcontent, writedate, readCount from board where mid=#{id}
  	</select>
  	

	<update id="deleteBoard">
		update board set bDelete = 1 where bno = #{bno}
	</update>
	
	<select id="selectLike" parameterType="HashMap" resultType="int">
		select EXISTS(select id, bno from likelist where id=#{id} and bno = #{bno}) as success;
	</select>
	
	<insert id="insertLike" parameterType="HashMap">
		insert into likelist(id, bno) values(#{id}, #{bno})
	</insert>
	
	<delete id="deleteLike" parameterType="HashMap">
		delete from likelist where id = #{id} and bno = #{bno}
	</delete>
	
	<select id="likeBoard" parameterType="String" resultType="Board">
		select b.title, b.writeDate, b.readCount
		from board b join likelist l
		on b.bno = l.bno
		where id = #{id}
	</select>

</mapper>



